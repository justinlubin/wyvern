module def localStorage(file : effects.File) : effects.Heap

import wyvern.String

effect read = {file.readEffect}
effect write = {file.writeEffect, file.createEffect}

def filenameFromLoc(loc : Int) : String
  "localStorage/file" + String.ofInt(loc) + ".txt"

def getWithDefault(loc : Int, otherwise : Unit => String) : {read} String
  val f = filenameFromLoc(loc)

  if (file.exists(f))
    file.read(f)
   else
    otherwise()

def set(loc : Int, s : String) : {write} Unit
  val f = filenameFromLoc(loc)

  if (!file.exists(f))
    file.create(f)

  file.write(f, s)
