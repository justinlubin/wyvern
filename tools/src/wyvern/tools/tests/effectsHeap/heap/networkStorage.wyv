module def networkStorage(db : Database) : Heap

import wyvern.String

effect read = {db.queryEffect}
effect write = {db.updateEffect}

def escape(s : String) : String
  s

def getWithDefault(loc : Int, otherwise : Unit => String) : {read} String
  val s = db.query("@loc" + String.ofInt(loc))
  if (String.equals(s, "__$EMPTY$__"))
    otherwise()
   else
    s

def set(loc : Int, s : String) : {write} Unit
  db.update("@loc" + String.ofInt(loc) + "='" + escape(s) + "'")
